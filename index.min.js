function Book(e){this.stage=e,this.pages=[],this.pageNumber=-1,this.currentPage=null}function Level(e,n,t){this.rows=n,this.columns=t,this._data=e,this.container=new PIXI.Container,this.container.hitArea=new PIXI.Rectangle(0,0,GAME_WIDTH,GAME_HEIGHT),this.container.on("mousedown",onMouseDown).on("mousemove",onMouseMove).on("mouseup",onMouseUp).on("mouseupoutside",onMouseUp),this._gridGraphic=new PIXI.Graphics,this._rects=[],this.leftHeld=!1,this.rightHeld=!1,this._gridGraphic.lineStyle(.5,16777215,1);for(var i=0;n>i;i++)this._gridGraphic.moveTo(0,SPACE_HEIGHT*i),this._gridGraphic.lineTo(GAME_WIDTH,SPACE_HEIGHT*i);for(i=0;t>i;i++)this._gridGraphic.moveTo(SPACE_WIDTH*i,0),this._gridGraphic.lineTo(SPACE_WIDTH*i,GAME_HEIGHT);for(this.container.addChild(this._gridGraphic),r=0;r<n;r++){var o=[];for(c=0;c<t;c++){var l=new PIXI.Rectangle(SPACE_WIDTH*c,SPACE_HEIGHT*r,SPACE_WIDTH,SPACE_HEIGHT);l.row=r,l.column=c,l.centerX=l.x+l.width/2,l.centerY=l.y+l.height/2,l.left=!1,l.right=!1,l.up=!1,l.down=!1,o.push(l)}this._rects.push(o)}e.forEach(function(e,n){e.forEach(function(e,t){if(0!==e){var i=new PIXI.Graphics;1===e?i.beginFill(16777215,.75):2===e&&i.beginFill(11645361,.5),i.drawEllipse(SPACE_WIDTH*t+SPACE_WIDTH/2,SPACE_HEIGHT*n+SPACE_HEIGHT/2,SPACE_WIDTH/3,SPACE_HEIGHT/3),i.endFill(),this.container.addChild(i),this._rects[n][t].graphic=i}}.bind(this))}.bind(this))}function onMouseDown(e){var n=e.data.originalEvent;level.leftHeld=0!==(1&n.buttons),level.rightHeld=0!==(4&n.buttons)}function onMouseUp(e){var n=e.data.originalEvent;level.leftHeld=0!==(1&n.buttons),level.rightHeld=0!==(4&n.buttons)}function onMouseMove(e){e.data.originalEvent;level._rects.forEach(function(n){n.forEach(function(n){if(n.contains(e.data.global.x,e.data.global.y)){if("undefined"!=typeof level.lastRect&&null!==level.lastRect){var t=level.lastRect,i=0,o=0;if(t.row!==n.row-1&&t.row!==n.row+1||t.column!==n.column){if(t.row===n.row&&(t.column===n.column-1||t.column===n.column+1))if(!level.leftHeld||(t.column!==n.column-1||"undefined"!=typeof t.rightLine&&null!==t.rightLine)&&(t.column!==n.column+1||"undefined"!=typeof n.rightLine&&null!==n.rightLine))level.rightHeld&&(t.column===n.column-1&&"undefined"!=typeof t.rightLine&&null!==t.rightLine||t.column===n.column+1&&"undefined"!=typeof n.rightLine&&null!==n.rightLine)&&(t.column===n.column-1?(level.container.removeChild(t.rightLine),t.rightLine.destroy(),t.rightLine=null,t.right=!1,n.left=!1):(level.container.removeChild(n.rightLine),n.rightLine.destroy(),n.rightLine=null,n.right=!1,t.left=!1));else if(n.up&&i++,n.down&&i++,n.left&&i++,n.right&&i++,t.up&&o++,t.down&&o++,t.left&&o++,t.right&&o++,1>=i&&1>=o){var r=new PIXI.Graphics;r.lineStyle(2,16776960,1),r.moveTo(t.centerX,t.centerY),r.lineTo(n.centerX,n.centerY),t.column===n.column-1?(t.rightLine=r,t.right=!0,n.left=!0):(n.rightLine=r,n.right=!0,t.left=!0),level.container.addChild(r)}}else if(!level.leftHeld||(t.row!==n.row-1||"undefined"!=typeof t.downLine&&null!==t.downLine)&&(t.row!==n.row+1||"undefined"!=typeof n.downLine&&null!==n.downLine))level.rightHeld&&(t.row===n.row-1&&"undefined"!=typeof t.downLine&&null!==t.downLine||t.row===n.row+1&&"undefined"!=typeof n.downLine&&null!==n.downLine)&&(t.row===n.row-1?(level.container.removeChild(t.downLine),t.downLine.destroy(),t.downLine=null,t.down=!1,n.up=!1):(level.container.removeChild(n.downLine),n.downLine.destroy(),n.downLine=null,n.down=!1,t.up=!1));else if(n.up&&i++,n.down&&i++,n.left&&i++,n.right&&i++,t.up&&o++,t.down&&o++,t.left&&o++,t.right&&o++,1>=i&&1>=o){var l=new PIXI.Graphics;l.lineStyle(2,16776960,1),l.moveTo(t.centerX,t.centerY),l.lineTo(n.centerX,n.centerY),t.row===n.row-1?(t.downLine=l,t.down=!0,n.up=!0):(n.downLine=l,n.down=!0,t.up=!0),level.container.addChild(l)}}level.lastRect=n}})})}function goToLevel(e){victory=!1,levelNum=e,"undefined"!=typeof level&&null!==level&&(stage.removeChild(level.container),level.container.destroy()),level=null,levelNum>=levels.length?(levelSelectBook.isEnd()&&levelSelectBook.next(),levelSelectBook.show()):(level=new Level(levels[levelNum],10,10),stage.addChild(level.container),level.container.interactive=level.container.buttonMode=!0)}function animate(){if(requestAnimationFrame(animate),!victory&&"undefined"!=typeof level&&null!==level&&level.isComplete()&&level.isPathComplete()){victory=!0,level.container.interactive=level.container.buttonMode=!1;var e=new PIXI.Container;e.addChild(function(){var e=new PIXI.Graphics,n=220,t=140;return e.lineStyle(10,855309,1),e.beginFill(6515823,1),e.drawRoundedRect(GAME_WIDTH/2-n/2,GAME_HEIGHT/2-t/2+55,n,t,15),e.endFill(),e}());var n=new PIXI.Graphics;n.beginFill(8374191,1),n.moveTo(0,0),n.lineTo(120,0),n.lineTo(120,-30),n.lineTo(170,25),n.lineTo(120,80),n.lineTo(120,50),n.lineTo(0,50),n.endFill(),n.x=GAME_WIDTH/2-85,n.y=GAME_HEIGHT/2+30,n.interactive=n.buttonMode=!0,n.on("click",function(){stage.removeChild(e),e.destroy(),goToLevel(levelNum+1)}),e.addChild(n),stage.addChild(e)}renderer.render(stage)}var SPACE_WIDTH=80,SPACE_HEIGHT=60,GAME_WIDTH=800,GAME_HEIGHT=600;Book.prototype={next:function(){this.goTo(this.pageNumber+1)},prev:function(){this.goTo(this.pageNumber-1)},goTo:function(e){this.pageNumber=e,"undefined"!=typeof this.currentPage&&null!==this.currentPage&&this.stage.removeChild(this.currentPage),this.isEnd()||(this.currentPage=this.pages[this.pageNumber],this.stage.addChild(this.currentPage))},isEnd:function(){return this.pageNumber>=this.pages.length||this.pageNumber<0},removeAndDestroy:function(){this.pages.forEach(function(e){this.stage.removeChild(e),e.destroy()})},hide:function(){this.currentPage.visible=!1},show:function(){this.currentPage.visible=!0}},Level.prototype={isComplete:function(){var e=[];return this._data.forEach(function(n,t){n.forEach(function(n,i){if(0!==n){var o=!1,r=this._rects[t][i],l=i-1>=0?this._rects[t][i-1]:null,d=i+1<this._rects[t].length?this._rects[t][i+1]:null,a=t-1>=0?this._rects[t-1][i]:null,u=t+1<this._rects.length?this._rects[t+1][i]:null;if(r.graphic.tint=16777215,1===n)r.left&&r.right&&!r.up&&!r.down?null!==l&&(l.up||l.down)?o=!0:null!==d&&(d.up||d.down)&&(o=!0):r.up&&r.down&&!r.left&&!r.right&&(null!==a&&(a.left||a.right)?o=!0:null!==u&&(u.left||u.right)&&(o=!0));else if(2===n){var c=null,h=null;r.left&&!r.right?c=l:r.right&&!r.left&&(c=d),r.up&&!r.down?h=a:r.down&&!r.up&&(h=u),null!==c&&c.left&&c.right&&!c.down&&!c.up&&null!==h&&h.up&&h.down&&!h.left&&!h.right&&(o=!0)}o&&(r.graphic.tint=65280),e.push(o)}}.bind(this))}.bind(this)),0===e.filter(function(e){return e===!1}).length},isPathComplete:function(){function e(n,t,i){var o=null;return null===o&&n.left&&(o=t[n.row][n.column-1],o.hOpen?o.hOpen=n.hOpen=!1:o=null),null===o&&n.right&&(o=t[n.row][n.column+1],o.hOpen?o.hOpen=n.hOpen=!1:o=null),null===o&&n.up&&(o=t[n.row-1][n.column],o.vOpen?o.vOpen=n.vOpen=!1:o=null),null===o&&n.down&&(o=t[n.row+1][n.column],o.vOpen?o.vOpen=n.vOpen=!1:o=null),null!==o?e(o,t,i,!1):n.hOpen||n.vOpen||n!==i?void 0:void(i.finished=!0)}var n=this._rects.reduce(function(e,n){return e.concat(n.filter(function(e){var n=0;return e.up&&n++,e.down&&n++,e.left&&n++,e.right&&n++,2===n}))},[]);if(0===n.length)return!1;n.forEach(function(e){e.hOpen=e.vOpen=!0});return n[0].finished=!1,e(n[0],this._rects,n[0],!0),0===n.filter(function(e){return e.open}).length&&n[0].finished}};var renderer=PIXI.autoDetectRenderer(GAME_WIDTH,GAME_HEIGHT,{backgroundColor:0});document.getElementById("game").appendChild(renderer.view);var levelNum=0,stage=new PIXI.Container,level=new Level(levels[levelNum],10,10);stage.addChild(level.container);var music=new Audio("level.mp3");music.loop=!0,music.play();var victory=!1,frontBook=new Book(stage);frontBook.pages.push(function(){var e=new PIXI.Container;return e.addChild(function(){var e=new PIXI.Graphics,n=3*GAME_WIDTH/7,t=3*GAME_HEIGHT/7;return e.lineStyle(10,855309,1),e.beginFill(6515823,1),e.drawRoundedRect(GAME_WIDTH/2-n/2,GAME_HEIGHT/2-t/2,n,t,15),e.endFill(),e}()),e.addChild(function(){var e=new PIXI.Text("Masyu",{font:"bold 38px Arial",stroke:16777215,strokeThickness:2,padding:10});return e.x=335,e.y=200,e}()),e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(8696712,1),e.drawRect(276,300,87,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){frontBook.removeAndDestroy(),goToLevel(0)}),e.addChild(function(){var e=new PIXI.Text("Play",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=299,e.y=307,e}()),e}()),e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(12505830,1),e.drawRect(422,300,100,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){frontBook.next()}),e.addChild(function(){var e=new PIXI.Text("Tutorial",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=436,e.y=307,e}()),e}()),e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(12505830,1),e.drawRect(339,358,110,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){frontBook.removeAndDestroy(),levelSelectBook.next()}),e.addChild(function(){var e=new PIXI.Text("Level Select",{font:"bold 14px Arial",stroke:16777215,strokeThickness:3});return e.x=350,e.y=368,e}()),e}()),e}()),frontBook.pages.push(function(){var e=new PIXI.Container;return e.addChild(function(){var e=new PIXI.Graphics,n=3*GAME_WIDTH/4,t=3*GAME_HEIGHT/4;return e.lineStyle(10,855309,1),e.beginFill(6515823,1),e.drawRoundedRect(GAME_WIDTH/2-n/2,GAME_HEIGHT/2-t/2,n,t,15),e.endFill(),e}()),e.addChild(function(){var e=new PIXI.Text("The object of the game is to create a single, continuous, non-intersecting loop passes that through all the special spaces. A line can enter and exit a grid cell in one of the four cardinal directions.\n\nYou play by holding a mouse button down and dragging from one grid cell to another. You add lines by holding down the LEFT mouse button, and remove them by holding down the MIDDLE mouse button",{font:"bold 20px Arial",stroke:16777215,strokeThickness:0,wordWrap:!0,wordWrapWidth:3*GAME_WIDTH/4-25});return e.x=117,e.y=103,e}()),e.addChild(function(){for(var e=[],n=0;20>=n;n++)e.push(PIXI.Texture.fromImage("add-split/frame_"+n+".gif"));var t=new PIXI.extras.MovieClip(e);return t.animationSpeed=.25,t.x=134,t.y=340,t.play(),t}()),e.addChild(function(){for(var e=[],n=0;24>=n;n++)e.push(PIXI.Texture.fromImage("remove-split/frame_"+n+".gif"));var t=new PIXI.extras.MovieClip(e);return t.animationSpeed=.25,t.x=GAME_WIDTH-334-150,t.y=340,t.play(),t}()),e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(12505830,1),e.drawRect(543,388,87,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){frontBook.next()}),e.addChild(function(){var e=new PIXI.Text("Next",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=566,e.y=395,e}()),e}()),e}()),frontBook.pages.push(function(){var e=new PIXI.Container;return e.addChild(function(){var e=new PIXI.Graphics,n=GAME_WIDTH/1.5,t=GAME_HEIGHT/1.5;return e.lineStyle(10,855309,1),e.beginFill(6515823,1),e.drawRoundedRect(GAME_WIDTH/2-n/2,GAME_HEIGHT/2-t/2,n,t,15),e.endFill(),e}()),e.addChild(function(){var e=new PIXI.Text("There are two types of special spaces: white and black.\n\nThe white space must be traveled straight through, but must turn in the previous and/or the next cell in its path.",{font:"bold 20px Arial",wordWrap:!0,wordWrapWidth:GAME_WIDTH/1.5-25});return e.x=155,e.y=120,e}()),e.addChild(function(){var e=new PIXI.Sprite.fromImage("white.png");return e.x=255,e.y=280,e}()),e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(12505830,1),e.drawRect(543,338,87,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){frontBook.prev()}),e.addChild(function(){var e=new PIXI.Text("Prev",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=566,e.y=345,e}()),e}()),e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(12505830,1),e.drawRect(543,388,87,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){frontBook.next()}),e.addChild(function(){var e=new PIXI.Text("Next",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=566,e.y=395,e}()),e}()),e}()),frontBook.pages.push(function(){var e=new PIXI.Container;return e.addChild(function(){var e=new PIXI.Graphics,n=GAME_WIDTH/1.5,t=GAME_HEIGHT/1.5;return e.lineStyle(10,855309,1),e.beginFill(6515823,1),e.drawRoundedRect(GAME_WIDTH/2-n/2,GAME_HEIGHT/2-t/2,n,t,15),e.endFill(),e}()),e.addChild(function(){var e=new PIXI.Text("There are two types of special spaces: white and black.\n\nThe black space must have a turn on their grid cell, but both the next and previous cells must have been traveled straight through.",{font:"bold 20px Arial",wordWrap:!0,wordWrapWidth:GAME_WIDTH/1.5-25});return e.x=155,e.y=120,e}()),e.addChild(function(){var e=new PIXI.Sprite.fromImage("black.png");return e.x=225,e.y=280,e}()),e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(12505830,1),e.drawRect(543,338,87,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){frontBook.prev()}),e.addChild(function(){var e=new PIXI.Text("Prev",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=566,e.y=345,e}()),e}()),e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(8696712,1),e.drawRect(543,388,87,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){frontBook.removeAndDestroy(),goToLevel(0)}),e.addChild(function(){var e=new PIXI.Text("Play",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=566,e.y=395,e}()),e}()),e}()),frontBook.next();var levelSelectBook=new Book(stage);levels.forEach(function(e,n){levelSelectBook.pages.push(function(){var e=new PIXI.Container;return e.addChild(function(){var e=new PIXI.Graphics,n=GAME_WIDTH/1.4,t=GAME_HEIGHT/1.1;return e.lineStyle(10,855309,1),e.beginFill(6515823,1),e.drawRoundedRect(GAME_WIDTH/2-n/2,GAME_HEIGHT/2-t/2,n,t,15),e.endFill(),e}()),e.addChild(function(){var e=new PIXI.Sprite.fromImage("lvlimages/lvl"+(n+1)+".png");return e.x=GAME_WIDTH/2-250,e.y=65,e}()),n>0&&e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(12505830,1),e.drawRect(210,488,87,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){levelSelectBook.prev()}),e.addChild(function(){var e=new PIXI.Text("Prev",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=233,e.y=495,e}()),e}()),e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(8696712,1),e.drawRect(GAME_WIDTH/2-43.5,488,87,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){goToLevel(n),levelSelectBook.hide()}),e.addChild(function(){var e=new PIXI.Text("Play",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=GAME_WIDTH/2-43.5+23,e.y=495,e}()),e}()),n<levels.length-1&&e.addChild(function(){var e=new PIXI.Graphics;return e.beginFill(12505830,1),e.drawRect(503,488,87,42),e.endFill(),e.interactive=e.buttonMode=!0,e.on("click",function(){levelSelectBook.next()}),e.addChild(function(){var e=new PIXI.Text("Next",{font:"bold 18px Arial",stroke:16777215,strokeThickness:3});return e.x=526,e.y=495,e}()),e}()),e}())}),animate();